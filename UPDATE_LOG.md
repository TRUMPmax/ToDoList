# 更新日志

## 2024年更新 - 功能增强版

### ✅ 已实现的功能

#### 1. 数据库持久化存储
- **SQLite数据库**：所有数据持久化存储在 `database.db` 文件中
- **数据持久性**：重启应用后，所有任务、专注时间记录、推荐结果都会保留
- **真实数据统计**：所有统计数据都基于数据库中的真实数据，不再是模拟数据

#### 2. 自定义标签系统
- **替换固定分类**：将原来的固定分类（工作/学习/一般/创意）改为自定义标签输入
- **多标签支持**：可以为一个任务添加多个标签，用逗号分隔（如：工作,重要,紧急）
- **标签过滤**：支持通过标签过滤任务
- **标签可视化**：在数据分析中按标签统计任务分布

#### 3. 数据清理机制
- **自动清理**：每天凌晨3点自动清理14天前的数据
- **清理内容**：
  - 已完成且超过14天的任务
  - 超过14天的专注时间记录
  - 超过14天的推荐记录（保留最新的）
- **防止数据库臃肿**：确保数据库只保留最近14天的数据

#### 4. 主页顶部专注计时器
- **实时计时**：在页面顶部显示专注计时器
- **开始/暂停/停止**：支持开始、暂停、继续、停止功能
- **自动记录**：停止计时器时自动记录专注时间到数据库
- **视觉反馈**：计时器有醒目的样式和实时更新

#### 5. 真实数据驱动的机器学习
- **使用真实数据**：机器学习模型现在使用数据库中的真实专注时间数据
- **特征提取**：基于过去14天的真实任务完成情况和专注时间
- **模型训练**：每10条新专注时间记录自动触发模型训练
- **个性化推荐**：基于用户真实行为数据提供专注时长推荐

#### 6. 增强的数据可视化
- **多种图表风格**：支持柱状图、折线图、面积图三种风格切换
- **交互式图表**：所有图表支持交互，鼠标悬停显示详细信息
- **新增图表**：
  - 任务标签分布（饼图）
  - 专注时长分布（环形图）
- **真实数据展示**：所有图表数据来自数据库真实记录

#### 7. 优化的数据分析
- **今日完成任务**：显示今天完成的任务数量
- **本周完成任务**：显示过去7天完成的任务数量
- **单次专注时间**：记录每次专注的时长，用于计算平均值
- **专注时间趋势**：显示过去7天每天的专注时间变化

### 📊 数据统计说明

#### 一周真实完成任务量
- **数据来源**：数据库中的 `tasks` 表
- **统计方式**：查询 `status='completed'` 且 `completed_at` 在过去7天内的任务
- **API端点**：`GET /api/analytics/weekly`
- **返回字段**：`completed_tasks`（本周总数）、`today_completed`（今日数量）

#### 专注时间统计
- **单次专注时间**：每次使用计时器停止时记录到 `focus_times` 表
- **平均专注时间**：基于过去7天所有专注时间记录计算平均值
- **专注时间趋势**：按日期统计每天的专注时间总和

### 🔧 技术改进

#### 数据库模型更新
```python
# 旧模型
category = db.Column(db.String(50), default='general')

# 新模型
tags = db.Column(db.String(500), default='')  # 支持多个标签
```

#### API更新
- `POST /api/tasks`：现在接受 `tags` 字段而不是 `category`
- `PUT /api/tasks/<id>`：支持更新 `tags` 字段
- `GET /api/analytics/weekly`：返回真实统计数据，包括 `today_completed` 和 `tasks_by_tags`

#### 前端更新
- 添加了顶部计时器组件
- 标签输入框替换分类选择框
- 图表风格切换器
- 增强的图表交互功能

### 🚀 使用说明

#### 使用自定义标签
1. 创建任务时，在"标签"字段输入标签（如：工作,重要）
2. 多个标签用逗号分隔
3. 编辑任务时可以修改标签
4. 使用标签过滤框可以快速筛选任务

#### 使用顶部计时器
1. 点击"开始"按钮开始计时
2. 计时过程中可以点击"暂停"暂停计时
3. 点击"继续"恢复计时
4. 点击"停止"结束计时并自动记录专注时间

#### 查看数据分析
1. 点击"数据分析"按钮
2. 使用图表风格切换器选择喜欢的图表样式
3. 查看各种统计数据和图表
4. 所有数据都来自真实的数据库记录

### ⚠️ 注意事项

1. **数据库迁移**：如果之前使用过旧版本，系统会自动将 `category` 字段迁移到 `tags` 字段
2. **数据清理**：系统会自动清理14天前的数据，请确保重要数据已备份
3. **专注时间记录**：只有使用顶部计时器停止时才会记录，确保至少记录0.1分钟才会保存

### 📝 后续改进建议

1. 添加数据导出功能
2. 支持自定义数据保留天数
3. 添加专注时间提醒功能
4. 支持标签的自动补全
5. 添加更多图表类型

